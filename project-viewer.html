<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generated Projects Viewer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .project-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        
        .project-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        .terminal {
            background-color: #1e1e1e;
            color: #f0f0f0;
            font-family: 'Courier New', monospace;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-y: auto;
            max-height: 300px;
            margin-bottom: 1rem;
        }
        
        .terminal-line {
            line-height: 1.5;
            margin-bottom: 0.25rem;
            white-space: pre-wrap;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <header class="bg-white shadow">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 flex items-center justify-between">
            <h1 class="text-3xl font-bold text-gray-900">Website Generator</h1>
            <div class="flex items-center gap-4">
                <span id="server-status" class="px-3 py-1 text-sm rounded-full bg-gray-200 text-gray-700">Server Status: Unknown</span>
                <button id="refresh-btn" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 text-sm font-medium">
                    Refresh
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <div>
            <!-- URL Input Bar -->
            <div class="bg-white shadow rounded-lg mb-6 p-6">
                <h2 class="text-lg font-medium text-gray-900 mb-3">Enter a website URL to generate</h2>
                <div class="flex">
                    <input type="text" id="url-input" class="flex-1 border-gray-300 rounded-l-md shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" placeholder="e.g., youtube.com, leetcode.com">
                    <button id="generate-btn" class="px-4 py-2 bg-indigo-600 text-white rounded-r-md hover:bg-indigo-700">
                        Generate
                    </button>
                </div>
                <div class="text-xs text-gray-500 mt-2">Enter a domain name and click Generate to create an interactive application</div>
            </div>
            
            <!-- Generation Progress -->
            <div id="generation-progress" class="bg-white shadow rounded-lg mb-6 p-6 hidden">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Generation in Progress</h3>
                <div class="space-y-4">
                    <div class="agent-progress" id="scraper-agent">
                        <div class="flex justify-between mb-1">
                            <span class="text-sm font-medium text-gray-700">Scraper Agent</span>
                            <span class="text-sm font-medium text-gray-700 agent-status">Pending...</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-indigo-600 h-2 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="agent-progress" id="semantic-parser-agent">
                        <div class="flex justify-between mb-1">
                            <span class="text-sm font-medium text-gray-700">Semantic Parser Agent</span>
                            <span class="text-sm font-medium text-gray-700 agent-status">Pending...</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-indigo-600 h-2 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="agent-progress" id="layout-generator-agent">
                        <div class="flex justify-between mb-1">
                            <span class="text-sm font-medium text-gray-700">Layout Generator Agent</span>
                            <span class="text-sm font-medium text-gray-700 agent-status">Pending...</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-indigo-600 h-2 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="agent-progress" id="component-synthesizer-agent">
                        <div class="flex justify-between mb-1">
                            <span class="text-sm font-medium text-gray-700">Component Synthesizer Agent</span>
                            <span class="text-sm font-medium text-gray-700 agent-status">Pending...</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-indigo-600 h-2 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="agent-progress" id="style-transfer-agent">
                        <div class="flex justify-between mb-1">
                            <span class="text-sm font-medium text-gray-700">Style Transfer Agent</span>
                            <span class="text-sm font-medium text-gray-700 agent-status">Pending...</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-indigo-600 h-2 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="agent-progress" id="validation-agent">
                        <div class="flex justify-between mb-1">
                            <span class="text-sm font-medium text-gray-700">Validation Agent</span>
                            <span class="text-sm font-medium text-gray-700 agent-status">Pending...</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-indigo-600 h-2 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="mt-6 flex justify-between items-center">
                        <div>
                            <span class="text-sm font-medium text-gray-700">Overall Progress:</span>
                            <span id="overall-progress-percentage" class="ml-2 text-sm font-medium text-indigo-700">0%</span>
                        </div>
                        <button id="cancel-generation" class="px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Main content area -->
            <div class="flex-1" id="preview-container">
                <!-- Project details -->
                <div class="bg-white shadow rounded-lg mb-6 overflow-hidden">
                    <div class="px-4 py-5 sm:px-6 bg-gray-50 border-b border-gray-200">
                        <h3 id="project-title" class="text-lg font-medium text-gray-900">React Project</h3>
                        <p id="project-description" class="text-sm text-gray-500">Full React app with components and routing.</p>
                    </div>
                    
                    <!-- Preview tabs -->
                    <div class="border-b border-gray-200">
                        <nav class="flex -mb-px px-6">
                            <button data-tab="preview" class="tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-indigo-500 font-medium text-sm text-indigo-600 mr-8">
                                Live Preview
                            </button>
                            <button data-tab="files" class="tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 mr-8">
                                Files
                            </button>
                            <button data-tab="terminal" class="tab-btn whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                                Terminal
                            </button>
                        </nav>
                    </div>
                    
                    <!-- Preview content -->
                    <div class="p-6">
                        <!-- Preview tab content -->
                        <div id="preview-tab" class="tab-content">
                            <div class="border border-gray-300 rounded-md overflow-hidden">
                                <div class="bg-gray-100 px-4 py-2 border-b border-gray-300 flex items-center">
                                    <div class="flex space-x-2 mr-4">
                                        <div class="w-3 h-3 rounded-full bg-red-500"></div>
                                        <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                                        <div class="w-3 h-3 rounded-full bg-green-500"></div>
                                    </div>
                                    <div id="preview-url" class="flex-1 bg-white rounded-md px-3 py-1 text-sm text-gray-500 truncate">
                                        http://localhost:5176/
                                    </div>
                                    <a id="external-preview" href="http://localhost:5176/" target="_blank" class="ml-2 text-indigo-600 text-sm hover:text-indigo-800">
                                        Open in New Tab
                                    </a>
                                </div>
                                
                                <div class="h-[70vh] overflow-hidden bg-white">
                                    <iframe id="preview-iframe" class="w-full h-full" src="about:blank"></iframe>
                                    
                                    <!-- Preview placeholder (shown when server is not running) -->
                                    <div id="preview-placeholder" class="w-full h-full flex items-center justify-center flex-col p-6 text-center">
                                        <div class="mb-4 text-gray-400">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                                            </svg>
                                        </div>
                                        <h3 class="text-lg font-medium text-gray-700 mb-2">Development Server Not Running</h3>
                                        <p class="text-gray-500 mb-4">Click "Start Development Server" to preview the project.</p>
                                        <button id="start-server-inline-btn" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm">
                                            Start Server
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Files tab content -->
                        <div id="files-tab" class="tab-content hidden">
                            <div class="mb-4">
                                <div class="flex items-center justify-between">
                                    <h3 class="text-sm font-medium text-gray-700">Project Structure</h3>
                                    <div id="file-path" class="text-xs text-gray-500">orchids-challenge/backend/generated/project</div>
                                </div>
                                <div class="mt-3 border border-gray-300 rounded-md overflow-auto max-h-[70vh]">
                                    <div id="file-tree" class="p-3 text-sm"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Terminal tab content -->
                        <div id="terminal-tab" class="tab-content hidden">
                            <div class="terminal" id="terminal-output">
                                <!-- Terminal content will be added here -->
                                <div class="terminal-line">Welcome to the project terminal.</div>
                                <div class="terminal-line">Use the buttons below to interact with the development server.</div>
                                <div class="terminal-line">&nbsp;</div>
                                <div class="terminal-line">$ _</div>
                            </div>
                            
                            <div class="flex gap-2">
                                <button id="run-npm-install" class="px-3 py-1 text-sm bg-gray-600 text-white rounded-md hover:bg-gray-700">
                                    npm install
                                </button>
                                <button id="run-npm-dev" class="px-3 py-1 text-sm bg-green-600 text-white rounded-md hover:bg-green-700">
                                    npm run dev
                                </button>
                                <button id="run-npm-build" class="px-3 py-1 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                    npm run build
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- No more hardcoded projects here -->
            </div>
        </div>
    </main>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM elements
            const tabBtns = document.querySelectorAll('.tab-btn');
            const urlInput = document.getElementById('url-input');
            const generateBtn = document.getElementById('generate-btn');
            const generationProgress = document.getElementById('generation-progress');
            const cancelGenerationBtn = document.getElementById('cancel-generation');
            const previewContainer = document.getElementById('preview-container');
            const overallProgressPercentage = document.getElementById('overall-progress-percentage');
            const projectTitle = document.getElementById('project-title');
            const projectDescription = document.getElementById('project-description');
            const fileTree = document.getElementById('file-tree');
            const filePath = document.getElementById('file-path');
            const previewIframe = document.getElementById('preview-iframe');
            const previewUrl = document.getElementById('preview-url');
            const externalPreview = document.getElementById('external-preview');
            const previewPlaceholder = document.getElementById('preview-placeholder');
            const serverStatus = document.getElementById('server-status');
            const terminalOutput = document.getElementById('terminal-output');
            const startServerInlineBtn = document.getElementById('start-server-inline-btn');
            const stopServerBtn = document.getElementById('stop-server-btn');
            const refreshBtn = document.getElementById('refresh-btn');
            
            // Terminal command buttons
            const runNpmInstall = document.getElementById('run-npm-install');
            const runNpmDev = document.getElementById('run-npm-dev');
            const runNpmBuild = document.getElementById('run-npm-build');
            
            // Tab content elements
            const previewTab = document.getElementById('preview-tab');
            const filesTab = document.getElementById('files-tab');
            const terminalTab = document.getElementById('terminal-tab');
            
            // Project configuration
            const projects = {
                'direct': {
                    title: 'Basic HTML/CSS',
                    description: 'Simple static HTML and CSS version of the website.',
                    path: 'orchids-challenge/backend/generated/direct',
                    previewPath: 'http://localhost:8002/generated/direct/index.html'
                },
                'enhanced': {
                    title: 'Enhanced Version',
                    description: 'Enhanced static HTML with improved styling and responsiveness.',
                    path: 'orchids-challenge/backend/generated/enhanced',
                    previewPath: 'http://localhost:8002/generated/enhanced/index.html'
                },
                'project': {
                    title: 'React Project',
                    description: 'Full React app with components and routing.',
                    path: 'orchids-challenge/backend/generated/project',
                    previewPath: 'http://localhost:5176/'
                },
                'project2': {
                    title: 'Interactive App',
                    description: 'Complex React application with advanced interactive features.',
                    path: 'orchids-challenge/backend/generated/project2',
                    previewPath: 'http://localhost:5177/'
                }
            };
            
            // Application state
            let currentProject = 'project';
            let serverRunning = false;
            let serverPort = 5176;
            const projectPorts = {
                'project': 5176,
                'project2': 5177
            };
            
            // Sample file structure (in a real app, this would come from the backend)
            const fileStructures = {
                'direct': [
                    { name: 'index.html', type: 'file' },
                    { name: 'styles.css', type: 'file' }
                ],
                'enhanced': [
                    { name: 'index.html', type: 'file' },
                    { name: 'styles.css', type: 'file' }
                ],
                'project': [
                    { name: '.gitignore', type: 'file' },
                    { name: 'eslint.config.js', type: 'file' },
                    { name: 'index.html', type: 'file' },
                    { name: 'package.json', type: 'file' },
                    { name: 'postcss.config.js', type: 'file' },
                    { name: 'tailwind.config.js', type: 'file' },
                    { name: 'tsconfig.json', type: 'file' },
                    { name: 'vite.config.ts', type: 'file' },
                    { 
                        name: 'src', 
                        type: 'folder',
                        children: [
                            { name: 'App.tsx', type: 'file' },
                            { name: 'index.css', type: 'file' },
                            { name: 'main.tsx', type: 'file' },
                            {
                                name: 'components',
                                type: 'folder',
                                children: [
                                    { name: 'Header.tsx', type: 'file' },
                                    { name: 'VideoCard.tsx', type: 'file' },
                                    { name: 'VideoGrid.tsx', type: 'file' },
                                    { name: 'VideoPlayer.tsx', type: 'file' }
                                ]
                            },
                            {
                                name: 'data',
                                type: 'folder',
                                children: [
                                    { name: 'mockData.ts', type: 'file' }
                                ]
                            },
                            {
                                name: 'pages',
                                type: 'folder',
                                children: [
                                    { name: 'HomePage.tsx', type: 'file' },
                                    { name: 'WatchPage.tsx', type: 'file' }
                                ]
                            }
                        ]
                    }
                ],
                'project2': [
                    { name: '.gitignore', type: 'file' },
                    { name: 'eslint.config.js', type: 'file' },
                    { name: 'index.html', type: 'file' },
                    { name: 'package.json', type: 'file' },
                    { name: 'postcss.config.js', type: 'file' },
                    { name: 'tailwind.config.js', type: 'file' },
                    { name: 'tsconfig.json', type: 'file' },
                    { name: 'vite.config.ts', type: 'file' },
                    { 
                        name: 'src', 
                        type: 'folder',
                        children: [
                            { name: 'App.tsx', type: 'file' },
                            { name: 'index.css', type: 'file' },
                            { name: 'main.tsx', type: 'file' },
                            {
                                name: 'components',
                                type: 'folder',
                                children: [
                                    { name: 'CodeEditor.tsx', type: 'file' },
                                    { name: 'Header.tsx', type: 'file' },
                                    { name: 'ProblemCard.tsx', type: 'file' },
                                    { name: 'ProblemDescription.tsx', type: 'file' },
                                    { name: 'ProblemList.tsx', type: 'file' }
                                ]
                            },
                            {
                                name: 'data',
                                type: 'folder',
                                children: [
                                    { name: 'mockData.ts', type: 'file' }
                                ]
                            },
                            {
                                name: 'pages',
                                type: 'folder',
                                children: [
                                    { name: 'HomePage.tsx', type: 'file' },
                                    { name: 'ProblemsPage.tsx', type: 'file' },
                                    { name: 'ProblemSolvePage.tsx', type: 'file' }
                                ]
                            }
                        ]
                    }
                ]
            };
            
            // Initialize application
            init();
            
            // URL generation and progress bar functionality
            generateBtn.addEventListener('click', startGeneration);
            cancelGenerationBtn.addEventListener('click', cancelGeneration);
            
            // Event listeners
            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const tabType = btn.getAttribute('data-tab');
                    if (tabType) {
                        switchTab(tabType);
                    }
                });
            });
            
            startServerInlineBtn.addEventListener('click', startServer);
            stopServerBtn.addEventListener('click', stopServer);
            refreshBtn.addEventListener('click', checkServerStatus);
            
            runNpmInstall.addEventListener('click', () => runNpmCommand('install'));
            runNpmDev.addEventListener('click', () => runNpmCommand('run dev'));
            runNpmBuild.addEventListener('click', () => runNpmCommand('run build'));
            
            // Functions
            function init() {
                // Set initial project
                switchProject('project');
                
                // Check server status
                checkServerStatus();
            }
            
            function checkServerStatus() {
                const port = projectPorts[currentProject] || 5176;
                
                // Reset status indicator
                serverStatus.textContent = 'Server Status: Checking...';
                serverStatus.className = 'px-3 py-1 text-sm rounded-full bg-gray-200 text-gray-700';
                
                // Add animation to indicate checking
                serverStatus.classList.add('animate-pulse');
                
                // Check if server is running (in a real app, this would be an actual fetch)
                simulateServerCheck(port)
                    .then(isRunning => {
                        serverRunning = isRunning;
                        updateServerUI();
                        
                        // Remove the animation
                        serverStatus.classList.remove('animate-pulse');
                    });
            }
            
            function simulateServerCheck(port) {
                return new Promise(resolve => {
                    // In a real app, we would do a fetch to the server
                    setTimeout(() => {
                        // For demo purposes, let's say the server is not running initially
                        resolve(false);
                    }, 1000);
                });
            }
            
            function switchProject(projectType) {
                // Update current project
                currentProject = projectType;
                
                // Update project info
                const project = projects[projectType];
                projectTitle.textContent = project.title;
                projectDescription.textContent = project.description;
                filePath.textContent = project.path;
                
                // Update file tree
                renderFileTree(fileStructures[projectType]);
                
                // Update preview URL
                previewUrl.textContent = project.previewPath;
                externalPreview.href = project.previewPath;
                
                // Check if this project has a server port
                serverPort = projectPorts[projectType];
                const hasServerPort = !!serverPort;
                
                if (hasServerPort) {
                    startServerInlineBtn.disabled = false;
                } else {
                    startServerInlineBtn.disabled = true;
                }
                
                // Reset iframe
                updatePreviewFrame();
                
                // Check server status
                checkServerStatus();
            }
            
            function updateServerUI() {
                if (serverRunning) {
                    serverStatus.textContent = 'Server Status: Running';
                    serverStatus.className = 'px-3 py-1 text-sm rounded-full bg-green-100 text-green-800';
                    startServerInlineBtn.disabled = true;
                    stopServerBtn.disabled = false;
                    if (previewPlaceholder) previewPlaceholder.classList.add('hidden');
                    if (previewIframe) previewIframe.classList.remove('hidden');
                } else {
                    serverStatus.textContent = 'Server Status: Stopped';
                    serverStatus.className = 'px-3 py-1 text-sm rounded-full bg-red-100 text-red-800';
                    startServerInlineBtn.disabled = false;
                    stopServerBtn.disabled = true;
                    if (previewPlaceholder) previewPlaceholder.classList.remove('hidden');
                    if (previewIframe) previewIframe.classList.add('hidden');
                }
                
                updatePreviewFrame();
            }
            
            function updatePreviewFrame() {
                const project = projects[currentProject];
                
                if (serverRunning && serverPort) {
                    previewIframe.src = project.previewPath;
                    previewIframe.classList.remove('hidden');
                } else if (currentProject === 'direct' || currentProject === 'enhanced') {
                    // Static HTML doesn't need a server
                    previewIframe.src = project.previewPath;
                    previewIframe.classList.remove('hidden');
                    previewPlaceholder.classList.add('hidden');
                } else {
                    previewIframe.src = 'about:blank';
                    previewIframe.classList.add('hidden');
                    previewPlaceholder.classList.remove('hidden');
                }
            }
            
            function switchTab(tabType) {
                // Update tab selection
                tabBtns.forEach(btn => {
                    const type = btn.getAttribute('data-tab');
                    if (type === tabType) {
                        btn.classList.remove('border-transparent', 'text-gray-500');
                        btn.classList.add('border-indigo-500', 'text-indigo-600');
                    } else {
                        btn.classList.add('border-transparent', 'text-gray-500');
                        btn.classList.remove('border-indigo-500', 'text-indigo-600');
                    }
                });
                
                // Hide all tabs
                previewTab.classList.add('hidden');
                filesTab.classList.add('hidden');
                terminalTab.classList.add('hidden');
                
                // Show selected tab
                if (tabType === 'preview') {
                    previewTab.classList.remove('hidden');
                } else if (tabType === 'files') {
                    filesTab.classList.remove('hidden');
                } else if (tabType === 'terminal') {
                    terminalTab.classList.remove('hidden');
                }
            }
            
            function renderFileTree(files, indent = 0) {
                if (!files || files.length === 0) {
                    fileTree.innerHTML = '<div class="text-gray-500">No files found</div>';
                    return;
                }
                
                let html = '';
                
                files.forEach(file => {
                    const indentSpace = '&nbsp;'.repeat(indent * 4);
                    const icon = file.type === 'folder' ? '📁' : '📄';
                    
                    html += `<div class="mb-1">${indentSpace}${icon} ${file.name}</div>`;
                    
                    if (file.type === 'folder' && file.children) {
                        html += renderFileTreeHTML(file.children, indent + 1);
                    }
                });
                
                fileTree.innerHTML = html;
            }
            
            function renderFileTreeHTML(files, indent = 0) {
                let html = '';
                
                files.forEach(file => {
                    const indentSpace = '&nbsp;'.repeat(indent * 4);
                    const icon = file.type === 'folder' ? '📁' : '📄';
                    
                    html += `<div class="mb-1">${indentSpace}${icon} ${file.name}</div>`;
                    
                    if (file.type === 'folder' && file.children) {
                        html += renderFileTreeHTML(file.children, indent + 1);
                    }
                });
                
                return html;
            }
            
            function addTerminalLine(text, className = '') {
                const line = document.createElement('div');
                line.className = `terminal-line ${className}`;
                line.textContent = text;
                terminalOutput.appendChild(line);
                terminalOutput.scrollTop = terminalOutput.scrollHeight;
            }
            
            function startServer() {
                // Add terminal output
                addTerminalLine('$ cd ' + projects[currentProject].path, 'terminal-command');
                addTerminalLine('$ npm run dev', 'terminal-command');
                
                // Show loading animation
                serverStatus.textContent = 'Server Status: Starting...';
                serverStatus.className = 'px-3 py-1 text-sm rounded-full bg-yellow-100 text-yellow-800 animate-pulse';
                
                // Simulate server start (this would be a real command in a backend integration)
                setTimeout(() => {
                    // Add terminal output for server start
                    const port = projectPorts[currentProject];
                    addTerminalLine('', 'terminal-output');
                    addTerminalLine('> project@0.1.0 dev', 'terminal-output');
                    addTerminalLine('> vite', 'terminal-output');
                    addTerminalLine('', 'terminal-output');
                    addTerminalLine('VITE v5.0.0 ready in 334 ms', 'terminal-output');
                    addTerminalLine('', 'terminal-output');
                    addTerminalLine(`➜  Local:   http://localhost:${port}/`, 'terminal-success');
                    addTerminalLine('➜  Network: use --host to expose', 'terminal-output');
                    addTerminalLine('➜  press h + enter to show help', 'terminal-output');
                    
                    // Update UI to show server is running
                    serverRunning = true;
                    updateServerUI();
                    
                    // Switch to preview tab to show the running app
                    switchTab('preview');
                }, 2000);
            }
            
            function stopServer() {
                // Add terminal output
                addTerminalLine('', 'terminal-output');
                addTerminalLine('Shutting down server...', 'terminal-output');
                
                // Show loading animation
                serverStatus.textContent = 'Server Status: Stopping...';
                serverStatus.className = 'px-3 py-1 text-sm rounded-full bg-yellow-100 text-yellow-800 animate-pulse';
                
                // Simulate server stop
                setTimeout(() => {
                    addTerminalLine('Server stopped', 'terminal-success');
                    addTerminalLine('$ ', 'terminal-command');
                    
                    // Update UI
                    serverRunning = false;
                    updateServerUI();
                }, 1000);
            }
            
            function runNpmCommand(command) {
                // Add command to terminal
                addTerminalLine(`$ npm ${command}`, 'terminal-command');
                
                // Different output based on command
                if (command === 'install') {
                    simulateNpmInstall();
                } else if (command === 'run dev') {
                    startServer();
                } else if (command === 'run build') {
                    simulateNpmBuild();
                }
            }
            
            function simulateNpmInstall() {
                // Simulate npm install output
                setTimeout(() => {
                    addTerminalLine('Installing dependencies...', 'terminal-output');
                }, 300);
                
                setTimeout(() => {
                    addTerminalLine('added 1256 packages, and audited 1257 packages in 5s', 'terminal-output');
                    addTerminalLine('215 packages are looking for funding', 'terminal-output');
                    addTerminalLine('found 0 vulnerabilities', 'terminal-success');
                    addTerminalLine('$ ', 'terminal-command');
                }, 2000);
            }
            
            function simulateNpmBuild() {
                // Simulate npm build output
                setTimeout(() => {
                    addTerminalLine('> project@0.1.0 build', 'terminal-output');
                    addTerminalLine('> vite build', 'terminal-output');
                    addTerminalLine('', 'terminal-output');
                }, 300);
                
                setTimeout(() => {
                    addTerminalLine('building for production...', 'terminal-output');
                }, 1000);
                
                setTimeout(() => {
                    addTerminalLine('dist/index.html          0.48 kB │ gzip: 0.32 kB', 'terminal-output');
                    addTerminalLine('dist/assets/index.js    143.89 kB │ gzip: 46.13 kB', 'terminal-output');
                    addTerminalLine('dist/assets/index.css    24.05 kB │ gzip: 4.28 kB', 'terminal-output');
                    addTerminalLine('Done in 3.2s', 'terminal-success');
                    addTerminalLine('$ ', 'terminal-command');
                }, 3000);
            }
            
            // URL input and generation functionality
            function startGeneration() {
                const url = urlInput.value.trim().toLowerCase();
                
                if (!url) {
                    alert('Please enter a URL');
                    return;
                }
                
                // Show the generation progress bar, hide the preview container
                generationProgress.classList.remove('hidden');
                previewContainer.classList.add('hidden');
                
                // Reset all progress bars
                const progressBars = document.querySelectorAll('.agent-progress .bg-indigo-600');
                const statusTexts = document.querySelectorAll('.agent-progress .agent-status');
                
                progressBars.forEach(bar => {
                    bar.style.width = '0%';
                });
                
                statusTexts.forEach(status => {
                    status.textContent = 'Pending...';
                    status.className = 'text-sm font-medium text-gray-700 agent-status';
                });
                
                overallProgressPercentage.textContent = '0%';
                
                // Start the generation process
                let generationCancelled = false;
                
                // Define agents and their processing times (in ms)
                const agents = [
                    { id: 'scraper-agent', name: 'Scraper Agent', time: 3000 },
                    { id: 'semantic-parser-agent', name: 'Semantic Parser Agent', time: 4000 },
                    { id: 'layout-generator-agent', name: 'Layout Generator Agent', time: 5000 },
                    { id: 'component-synthesizer-agent', name: 'Component Synthesizer Agent', time: 6000 },
                    { id: 'style-transfer-agent', name: 'Style Transfer Agent', time: 4000 },
                    { id: 'validation-agent', name: 'Validation Agent', time: 2000 }
                ];
                
                const totalTime = agents.reduce((sum, agent) => sum + agent.time, 0);
                let completedTime = 0;
                let currentIndex = 0;
                
                // Function to update progress bar for current agent
                function updateAgentProgress(agentId, progress) {
                    const progressBar = document.querySelector(`#${agentId} .bg-indigo-600`);
                    const statusText = document.querySelector(`#${agentId} .agent-status`);
                    
                    if (progressBar && statusText) {
                        progressBar.style.width = `${progress}%`;
                        
                        if (progress < 100) {
                            statusText.textContent = `Working... ${Math.round(progress)}%`;
                        } else {
                            statusText.textContent = 'Completed';
                            statusText.className = 'text-sm font-medium text-green-700 agent-status';
                        }
                    }
                    
                    // Update overall progress
                    const overallProgress = Math.round(((completedTime + (progress / 100) * agents[currentIndex].time) / totalTime) * 100);
                    overallProgressPercentage.textContent = `${overallProgress}%`;
                }
                
                // Process agents one by one
                function processNextAgent() {
                    if (generationCancelled || currentIndex >= agents.length) {
                        completeGeneration(url);
                        return;
                    }
                    
                    const agent = agents[currentIndex];
                    const agentElement = document.getElementById(agent.id);
                    
                    if (agentElement) {
                        const statusText = agentElement.querySelector('.agent-status');
                        statusText.textContent = 'Starting...';
                    }
                    
                    // Simulate agent progress
                    const startTime = Date.now();
                    const agentInterval = setInterval(() => {
                        if (generationCancelled) {
                            clearInterval(agentInterval);
                            return;
                        }
                        
                        const elapsed = Date.now() - startTime;
                        const progress = Math.min(100, (elapsed / agent.time) * 100);
                        
                        updateAgentProgress(agent.id, progress);
                        
                        if (progress >= 100) {
                            clearInterval(agentInterval);
                            completedTime += agent.time;
                            currentIndex++;
                            setTimeout(processNextAgent, 500); // Small delay between agents
                        }
                    }, 100);
                }
                
                // Start processing the first agent
                processNextAgent();
                
                // Function to handle generation completion
                function completeGeneration(url) {
                    if (generationCancelled) {
                        generationProgress.classList.add('hidden');
                        previewContainer.classList.remove('hidden');
                        return;
                    }
                    
                    // Route to appropriate project based on URL
                    let targetProject = 'project'; // Default
                    
                    if (url.includes('youtube.com') || url.includes('youtube')) {
                        targetProject = 'project'; // YouTube-like project
                    } else if (url.includes('leetcode.com') || url.includes('leetcode')) {
                        targetProject = 'project2'; // Interactive coding project
                    }
                    
                    // Hide progress and show the appropriate project
                    setTimeout(() => {
                        generationProgress.classList.add('hidden');
                        previewContainer.classList.remove('hidden');
                        
                        // Switch to the appropriate project
                        switchProject(targetProject);
                        
                        // Start the server automatically
                        startServer();
                    }, 1000);
                }
                
                // Set up cancel button
                cancelGenerationBtn.onclick = function() {
                    generationCancelled = true;
                };
            }
            
            function cancelGeneration() {
                generationProgress.classList.add('hidden');
                previewContainer.classList.remove('hidden');
            }
        });
    </script>
